language: node_js
node_js:
- '5'

before_deploy:
- npm install browserify coffeeify
- mkdir -p deploy/meshblu-device-schema-transmogrifier/latest
- mkdir -p deploy/meshblu-device-schema-transmogrifier/$TRAVIS_TAG
- node_modules/.bin/browserify -s MeshbluDeviceSchemaTransmogrifier -t coffeeify src/transmogrifier.coffee > deploy/meshblu-device-schema-transmogrifier/latest/meshblu-device-schema-transmogrifier.bundle.js
- gzip deploy/meshblu-device-schema-transmogrifier/latest/meshblu-device-schema-transmogrifier.bundle.js
- mv deploy/meshblu-device-schema-transmogrifier/latest/meshblu-device-schema-transmogrifier.bundle.js.gz  deploy/meshblu-device-schema-transmogrifier/latest/meshblu-device-schema-transmogrifier.bundle.js
- cp deploy/meshblu-device-schema-transmogrifier/latest/meshblu-device-schema-transmogrifier.bundle.js deploy/meshblu-device-schema-transmogrifier/$TRAVIS_TAG/meshblu-device-schema-transmogrifier.bundle.js


deploy:
  - provider: npm
    email: serveradmin@octoblu.com
    api_key:
      secure: DNRvH4yLm3OrbAypLTW0KJFysSxmnCym7gzqjU5InQL4ai9e9DNymw+Ff1b5DnHy3sxcdq+5YqkOfd1M9Tun0DKspyd48mXPkHEt0NLDtRsr+/fot3FwbnPuWaOFmjlfNp0HrRh8H2TCQVaDW/Mbaiwm1tCWbZ4dl5njhrtKQCAW9FJSxhHfPppJbixy+L2V1dICrxDdbaQZe2vvrL2n7OlS7EZvBS5i3uI3OQWSnAMmRJuwlvmu+mRn1yC7YpoJeGErEKs3PD3frlo7J+fLh4WUZCtpuVdcVymmOiA98DeRFhrhOjjpuDE/BBSe9jhvfs8b83XiJfN3L4nrefrcXpptZ0lXnGnwj70H2TjCID3EBeVwztTMMr3AILHmpulmrjr8ztJj+mjujONl2P42AuTzrFASu/xi1AnyyGDk71F+nzA9REKEKN89Xy0kN4jHGF+GnhC6i7JA/ZTo+OOZQdqkgcvwTrP2dA2lWt0feUDlstwtaEoPzUTwDL/nvXLgZDSdrJkSEf/0EYbjhLyxK3jeaU9M8Em3pnj73Txe2fmx0h9XVH7oheONGYIIQlUjuZuXbP8kDnLooYUrptdsh3YGKL6ZlbL2PRSb4iFDsIAxiJgCOfLZ5f+DUwPRZkBnpzo4IAzuDJfnHRq54c+USiEal8waYNfpxqUv4XtHQvk=
    on:
      tags: true
      branches: true

  - provider: s3
    access_key_id: AKIAJIBYB2JBGPDSWGAQ
    secret_access_key:
      secure: ueuYRpLXsS5nIE9Jwb1tMGTEmJ83hqilk2rABk6YFbHU4Z0RJaruLRXtwQQRI+3aO3ro/oKzE9BcJjNZLoe+g+M5noDduFRjyoYzPxADImx9NoXYeQl+8lUu+xdGYiaf/QZl0ugmJy/TEtqmt08Y6Ai4K/3RGM1YY11wZyCGj9t+HcImHv2Lcf72WWrJ5TS8V1ndWF4A5lSTu6tECHnDE1wA+Br3pMD2v0Za7c4ORWfvqnKEP3DLu6E/nd9CO/Lml3cxhq37JA3LHy6HulyZaB4UD6zW6mJHRMJASS3oNdVjjKKt5ehWB0RvwTvjxpKiNY6OGjU+9WBFOE2Pkq9ASxYEd4kKsWyRs5mWs94Yg+0Uv+xEdQJdEp0hx35EQek6iYCzuruB4VvQzo+mmpPLyYZ45YYu56HJ4BzyCCRn8/uDZdQIMCn13pxrXB0MsqDHyfLQZreRA3swGzQLz/j76FkW0E7yzIWe8aospD8BzpZF04Yw3gU9/H8bIB3sqsFoSj+paOBBwFnX1OjUrtEkw11xu1Z9qGiI6bgEZN69WitqfjFUQhsUfKDmQH2AX9NAoDr8n4bi7m+TfZd1f/FiRfFLtBfxIiziaZv61lPKBHSujoTFZNv5gmxL4Ute0kg/knAVd0Bw7V8TVnfZo9FtudQyVG+jZrybVZ3S3YLRYjE=
    bucket: octoblu-cdn
    region: us-west-2
    skip_cleanup: true
    local-dir: deploy
    detect_encoding: true
    upload-dir: js
    on:
      tags: true
      all_branches: true
